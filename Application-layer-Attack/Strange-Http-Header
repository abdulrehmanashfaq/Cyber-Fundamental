Detecting Strange HTTP Headers

When high-volume fuzzing isn't present, attackers use stealthier techniques by manipulating HTTP headers. This allows them to bypass security filters, access internal resources, or perform request smuggling.
1. Host Header Anomalies

The Host header is a primary target for attackers seeking to access non-public "Virtual Hosts" or internal management interfaces.
Attack Scenarios

    Bypassing Access Controls: Setting Host: 127.0.0.1 or Host: localhost to trick the server into thinking the request originated locally, granting access to restricted panels (e.g., /server-status).

    Virtual Host Enumeration: Probing for internal subdomains like admin, dev, staging, or internal.

    Password Reset Poisoning: Changing the Host header to a malicious domain so the server generates password reset links pointing to the attacker's infrastructure.

Detection Patterns
Tool	            Logic
Wireshark	        http.request and (!(http.host == "target.com"))
Tshark	          `tshark -r traffic.pcap -Y "http.request" -T fields -e http.host

2. HTTP Request Smuggling & CRLF Injection

This involves injecting Carriage Return (%0d) and Line Feed (%0a) characters into headers or URLs to "splice" a single request into two.
Case Study: CVE-2023-25690

In vulnerable Apache configurations using mod_proxy and mod_rewrite, an attacker can smuggle a request through the $1 parameter in a RewriteRule.

Vulnerable Config:
Apache

RewriteRule "^/categories/(.*)" "http://192.168.10.100:8080/categories.php?id=$1" [P]

Smuggled Payload:
HTTP

GET /categories/1%20HTTP/1.1%0d%0aHost:localhost%0d%0a%0d%0aGET%20/admin HTTP/1.1

Detection Signal

    HTTP 400 Errors: The proxy or backend often gets confused by the malformed syntax, leading to 400 Bad Request responses.

    The "Success" Follow-up: Watch for a 200 OK response to a sensitive internal path immediately following a 400 error from the same source IP.

3. Unusual HTTP Verbs (Methods)

Standard traffic uses GET and POST. Anything else is often a sign of reconnaissance or exploitation.

    Reconnaissance: OPTIONS is used to see which methods the server supports.

    File Manipulation: PUT and DELETE are used to upload web shells or destroy data.

    Header Theft: TRACE can be used to bypass HttpOnly cookie flags.

Investigation Filter

    Wireshark: http.request.method != "GET" && http.request.method != "POST"

4. User-Agent Spoofing

While easily changed, User-Agents provide clues about the tools an attacker is using.

    Default Tool Strings: sqlmap/1.x, Nikto, Nmap scripting engine.

    The "Empty" Agent: Automated scripts often fail to set a User-Agent, resulting in an empty or missing fieldâ€”a high-fidelity indicator of non-human traffic.

    Outdated Browsers: Attackers may use very old strings (e.g., Mozilla/4.0) which are common defaults in older exploit frameworks.

5 Hardening & Mitigation Checklist

    [ ] Strict Host Validation: Configure the web server to reject any request that does not match the predefined server name.

    [ ] Disable Unused Methods: Use AllowMethods or LimitExcept in Apache/Nginx to permit only GET and POST.

    [ ] Normalize Inbound Requests: Use a WAF or modern proxy to strip CRLF characters from inbound URIs before they reach the backend.

    [ ] Update Proxy Modules: Ensure Apache is version 2.4.56 or higher to remediate CVE-2023-25690.
