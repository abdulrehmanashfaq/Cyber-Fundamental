# Forensic Analysis: TCP RST Injection and Hijacking Anomalies

## 1. Concept: The TCP Reset (RST) Attack
A TCP Reset attack is a method used to abruptly terminate a connection between two parties (e.g., a Client and a Server). By injecting a packet with the `RST` flag set, the attacker tricks the targets into thinking the other side has crashed or closed the session.

### Technical Requirements for the Attacker:
1.  **Spoofed IP:** The packet must appear to come from the trusted partner.
2.  **Matching Ports:** The attacker must know the Source and Destination ports.
3.  **In-Window Sequence Numbers ($SEQ$):** The receiver will ignore the reset if the sequence number is not what it expects next.

---

## 2. Detection via Layer 2 (MAC Address Verification)
In a local network, the IP address is easily faked, but the **MAC Address** (Hardware Address) is harder to hide because it is required for the packet to move through physical switches.

### The "Mismatched MAC" Indicator:
If your network logs show that `192.168.10.4` is assigned to an Apple laptop (`aa:aa:aa:aa:aa:aa`), but a "Reset" packet arrives claiming to be from that IP but carrying a Dell MAC address (`bb:bb:bb:bb:bb:bb`), you have confirmed an injection.



---

## 3. The "Unseen Segment" Mystery in Wireshark
When analyzing a capture, you may see the expert info: **[TCP ACKed unseen segment]**. This is often the "smoking gun" of a sophisticated hijacking attempt.

### How it Happens (The "Race" Scenario):
1.  **Interception:** An attacker (acting as a Man-in-the-Middle) sees a client send a request. They "hold" or delay that packet.
2.  **Injection:** The attacker quickly sends their own "ghost" packet to the server using the client's identity.
3.  **The Server Responds:** The server receives the attacker's packet and sends an Acknowledgment (ACK) back.
4.  **The Capture Conflict:** Your Wireshark tool sees the Server's ACK. However, because the attacker delayed the original client packet, Wireshark hasn't recorded any data that justifies that ACK.
5.  **The Result:** Wireshark flags the ACK as being for an "unseen" segment.

---

## 4. Practical Scenario: The "BGP Hijack" or "Session Kill"
**The Setup:** A workstation (Client) is downloading a sensitive file from a Server. An attacker is on the same local subnet.

**The Action:**
* The attacker wants to kill the download. They use a tool to sniff the current $SEQ$ numbers.
* The attacker sends a packet: `Src: Server_IP, Dst: Client_IP, Flag: RST`.
* **The Twist:** To ensure the Client doesn't try to recover, the attacker also sends a spoofed ACK to the Server for data the Client hasn't even finished sending yet.

**The Forensic Evidence:**
* **In Wireshark:** You see the Server send an ACK for $SEQ$ 5000. However, looking back in your logs, the last data the Client sent was only at $SEQ$ 4000. Wireshark marks the Server's packet as **[TCP ACKed unseen segment]**.
* **In Switch Logs:** You see "MAC Flapping" alerts. The Server's MAC address is jumping between the actual uplink port and the attacker's port.
* **The Conclusion:** This wasn't a network glitch. The "Unseen Segment" proves a third party moved the sequence numbers forward before the legitimate client could.



---

## 5. Summary Table for Investigators

| Observation               | Meaning |

| **Unexpected RST Packet** | A connection was forced closed.                                                             |
| **MAC Address Mismatch**  | The packet was sent by a different device than the IP owner.                                |
| **ACKed Unseen Segment**  | The server is responding to data the attacker sent (or the attacker delayed the real data). |
| **MAC Flapping**          | The attacker is actively trying to impersonate another device on the switch.                |

---

## 6. Recommended Defenses
* **Dynamic ARP Inspection (DAI):** Hardens the network so only the "real" MAC can send traffic for an IP.
* **Port Security:** Limits a switch port to a single, authorized MAC address.
* **Encryption (TLS):** Makes it nearly impossible for an attacker to see the $SEQ$ numbers needed to craft the Reset.
